# 总结与感想

**21373293     王雨帆**

## 1 总体架构

​	我的设计架构整体上比较清晰合理，前端 - 中端 - 后端。

​	前端和后端的架构都比较规整。

​	但是中端的局部架构我认为并不是很好，一是 `LocalVar` 这个类的设计，影响了后续的 LLVM 生成；二是最开始没有设置 `Constant` 类，最后在生成 LLVM 时特判等方法怎么办也行不通的时候，才加了 `Constant` 类，改了很多地方。我觉得主要问题是写 LLVM 的时候太心急了，总想快点完成，而不是静下心来完完全全理解 LLVM ，再去生成。没有设计好就动笔，导致架构混乱，后续一直打补丁。此外，实验教程对 LLVM 的讲解并不详尽，理论课程根本不涉及 LLVM ，只能靠自己搜寻网络资料、阅读官方文档，感觉难度还是比较大的。

## 2 实现细节

- 我的实现整体还是比较好的，但是有两个地方我认为没有实现好。

  - 错误处理

    ​	我的错误处理是集成在 `Parser` 里的，其实 `Parser` 本身逻辑就比较复杂，再加上逻辑复杂的错误处理，大大降低了程序的鲁棒性。而且我的错误处理写的很乱，各种特判，写了很多`flagxxx` 。

  - LLVM 的数组生成

    ​	尤其是 LLVM 的数组传参、存储、指针使用，完全是靠各种字符串特判来实现的，不是很有逻辑，当然这也与我自己对 LLVM 理解不透彻有关系。

- 我认为实现最好的细节也有一处，我相当满意。

  - 短路求值

    ​	还记得短路求值是我在某次上机监考的过程中想明白的，画出了草图，然后非常有逻辑地优美地实现了短路求值。

    ![1](F:\Complie\Compile\短路求值1.png)

​						![1](F:\Complie\Compile\短路求值3.png)

## 3 时间安排

​	说实话，我觉得我的编译实验并没有完成的很好，没有达到我最初的预期，我觉得时间安排是我最大的问题。我在还有两天截止的时候才写完代码生成1，在还有两天实验完全截止的时候开始写代码优化和文档，并没有游刃有余地去研究编译实验，更多的时候是追着 ddl 跑。诚然这学期很忙，事情很多，但是我们可能大多数时间都没办法只完全投入干一件事；大二上是这样，只完全投入计组实验，然后其他课程成绩都很差；大二下是这样，只完全投入 OO ，另一门核专 OS 学得一塌糊涂；这学期倒是编译、数据库、重修、冯如杯、科研、助教，什么都抓，但导致什么完成度都不高。

​	所以我认为，高效率、多线程完成任务是我仍需好好思考的问题，虽然本科留给我的时间也不长了，前两三年我也实现得并不好，不过还是要摆平心态，大学就是用来试错和探索的，take it easy~

​	到最后感叹的最多就是 “如果我早点开始写优化该多好啊”“如果我多分一些时间给编译实验多好啊”，也许这就是遗憾吧。

## 4 课程建议

- LLVM 部分的教程可以更加完善一些，首先讲清楚 LLVM 语言的特性，其次是数组、指针部分我觉得可以讲解的更细一些。
- 理论课程希望可以统一一下，期末复习和同学讨论的时候发现不同老师对于分配全局寄存器、符号表设计等讲的不尽相同，我希望这些可以更加统一。